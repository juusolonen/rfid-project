@page "{id:guid}"
@model WebUI.Pages.Users.DetailsModel
@{
    ViewData["Title"] = "User Details";
}

<div class="container mt-5">
    <div class="text-center mb-4">
        <h1 class="display-4">K√§ytt√§j√§: @Model.User.Username</h1>
    </div>

    @if (Model.User == null)
    {
        <div class="alert alert-danger">K√§ytt√§j√§√§ ei l√∂ydy.</div>
    }
    else
    {
        <!-- User Info Section -->
        <div class="table-responsive mb-4">
            <table class="table table-bordered table-striped table-hover text-center align-middle">
                <thead class="table-dark">
                    <tr>
                        <th colspan="2" class="text-center">Tiedot</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>K√§ytt√§j√§n tunniste</strong></td>
                        <td>@Model.User.TagIdentifier</td>
                    </tr>
                    <tr>
                        <td><strong>Nimi</strong></td>
                        <td>@Model.User.Username</td>
                    </tr>
                    <tr>
                        <td><strong>Poistettu</strong></td>
                        <td>@(Model.User.Deleted ? "Kyll√§" : "Ei")</td>
                    </tr>
                    <tr>
                        <td><strong>Poistopvm</strong></td>
                        <td>@(Model.User.DeletedAt?.ToString("dd.MM.yyyy HH:mm") ?? "-")</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Called Events Section -->
        <div class="mb-4">
            <h3 class="mb-3">K√§ytt√§j√§n tapahtumat</h3>
            @if (Model.CalledEvents?.Any() == true)
            {
                <table class="table table-bordered table-striped table-hover text-center align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th>K√§sitelty</th>
                        <th>Pvm</th>
                        <th>H√§iri√∂</th>
                        <th>H√§iri√∂n syy</th>
                        <th>Ty√∂kalut</th>
                        <th>Tapahtumatyyppi</th>
                        <th>Kohde t√§gi</th>
                        <th>Kohde t√§git</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var eventItem in Model.CalledEvents)
                    {
                        <tr>
                            <td>@(eventItem.Processed ? "‚úÖ" : "üõë")</td>
                            <td>@eventItem.ReceivedAt.ToString("dd.MM.yyyy HH:mm")</td>
                            <td>@(eventItem.Faulted ? "Kyll√§" : "Ei")</td>
                            <td>@(eventItem.Faulted ? eventItem.FaultReason : "-")</td>
                            <td>@(Model.GetToolNames(eventItem.Tools) ?? "-")</td>
                            <td>@eventItem.ProcessedData.Action</td>
                            <td>@eventItem.ProcessedData.Tag</td>
                            <td>@(string.Join(",", eventItem.ProcessedData.TagNames.ToArray()) ?? "-")</td>
                        </tr>
                    }
                    </tbody>
                </table>
            }
            else
            {
                <p>Ei tapahtumia.</p>
            }
        </div>

                   <!-- Targeted Events Section -->
        <div>
            <h3 class="mb-3">K√§ytt√§j√§√§n kohdistuneet tapahtumat</h3>
            @if (Model.TargetedEvents?.Any() == true)
            {
                <table class="table table-bordered table-striped table-hover text-center align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th>K√§sitelty</th>
                        <th>Pvm</th>
                        <th>L√§hde</th>
                        <th>H√§iri√∂</th>
                        <th>H√§iri√∂n syy</th>
                        <th>Ty√∂kalut</th>
                        <th>Tapahtumatyyppi</th>
                        <th>Kohde t√§gi</th>
                        <th>Kohde t√§git</th>
                    </tr>
                    </thead>
                    <tbody>
                    @if (Model.TargetedEvents != null)
                    {
                        foreach (var eventItem in Model.TargetedEvents)
                        {
                            <tr>
                                <td>@(eventItem.Processed ? "‚úÖ" : "üõë")</td>
                                <td>@eventItem.ReceivedAt.ToString("dd.MM.yyyy HH:mm")</td>
                                <td>@eventItem.ProcessedData.InitiatorName/@eventItem.ProcessedData.InitiatorTagEPC</td>
                                <td>@(eventItem.Faulted ? "Kyll√§" : "Ei")</td>
                                <td>@(eventItem.Faulted ? eventItem.FaultReason : "-")</td>
                                <td>@(Model.GetToolNames(eventItem.Tools) ?? "-")</td>
                                <td>@eventItem.ProcessedData.Action</td>
                                <td>@eventItem.ProcessedData.Tag</td>
                                <td>@(string.Join(",", eventItem.ProcessedData.TagNames.ToArray()) ?? "-")</td>
                            </tr>
                        }
                    }
                    </tbody>
                </table>
            }
            else
            {
                <p>Ei tapahtumia.</p>
            }
        </div>
    }
</div>
